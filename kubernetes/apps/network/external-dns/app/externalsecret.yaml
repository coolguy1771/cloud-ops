---
# ExternalSecret for AWS Roles Anywhere configuration
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: external-dns-aws-credentials
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword
  target:
    name: external-dns-aws-credentials
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # AWS Roles Anywhere ARNs
        AWS_TRUST_ANCHOR_ARN: "{{ .trust_anchor_arn }}"
        AWS_PROFILE_ARN: "{{ .profile_arn }}"
        AWS_ROLE_ARN: "{{ .role_arn }}"
        AWS_REGION: "{{ .aws_region }}"
        # X.509 certificate and key for Roles Anywhere authentication
        certificate.pem: "{{ .certificate }}"
        private-key.pem: "{{ .private_key }}"
  # SDK format: <item>/<field>
  # 1Password item: external-dns-aws-roles-anywhere
  data:
    - secretKey: trust_anchor_arn
      remoteRef:
        key: external-dns-aws-roles-anywhere/trust_anchor_arn
    - secretKey: profile_arn
      remoteRef:
        key: external-dns-aws-roles-anywhere/profile_arn
    - secretKey: role_arn
      remoteRef:
        key: external-dns-aws-roles-anywhere/role_arn
    - secretKey: aws_region
      remoteRef:
        key: external-dns-aws-roles-anywhere/aws_region
    - secretKey: certificate
      remoteRef:
        key: external-dns-aws-roles-anywhere/certificate
    - secretKey: private_key
      remoteRef:
        key: external-dns-aws-roles-anywhere/private_key
